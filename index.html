<!DOCTYPE html>
<html>

<head>
  <title>Population in Singapore, 2021</title>
  <meta charset="UTF-8" />
  <style></style>
</head>

<body>
  <h2 style="font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
        text-align: center;
        color: slategray;">
    Population in Singapore, 2021
    </h1>
    <svg></svg>
    <script type="module">
      import * as d3 from 'https://cdn.skypack.dev/d3@7';

      let width = 1000,
        height = 600;

      let svg = d3.select('svg').attr('viewBox', '0 0 ' + width + ' ' + height);

      // Load external data
      Promise.all([d3.json('sgmap.json'), d3.csv('population2021.csv')]).then(
        data => {
          console.log(data[0]);
          console.log(data[1]);

          // Map and projection
          var projection = d3
            .geoMercator()
            .center([103.851959, 1.29027])
            .fitExtent(
              [
                [20, 20],
                [980, 580],
              ],
              data[0]
            );

          let geopath = d3.geoPath().projection(projection);

          svg
            .append('g')
            .attr('id', 'districts')
            .selectAll('path')
            .data(data[0].features)
            .enter()
            .append('path')
            .attr('d', geopath)
            .attr('fill', feature => {
              let subzoneName = feature['properties']['Subzone Name'];
              let areaPopulation = data[1].find(item => {
                return (
                  item['Subzone'].toLowerCase() == subzoneName.toLowerCase()
                );
              });

              if (areaPopulation == null) {
                let planningAreaName =
                  feature['properties']['Planning Area Name'];
                areaPopulation = data[1].find(item => {
                  return (
                    item['Planning Area'].toLowerCase() ==
                    planningAreaName.toLowerCase()
                  );
                });
              }

              var population = areaPopulation['Population'];
              if (population == '-') {
                population = 0.0;
              } else {
                population = parseFloat(population, 10);
              }

              if (population < 8000) {
                return '#FFEBD6';
              } else if (8000 <= population && population < 16000) {
                return '#F5CBAE';
              } else if (16000 <= population && population < 24000) {
                return '#EBA988';
              } else if (24000 <= population && population < 32000) {
                return '#E08465';
              } else if (32000 <= population && population < 40000) {
                return '#D65C45';
              } else if (40000 <= population && population < 48000) {
                return '#CC3528';
              } else if (48000 <= population && population < 64000) {
                return '#C40A09';
              } else {
                return '#500A09';
              }
            });
        }
      );
    </script>
</body>

</html>